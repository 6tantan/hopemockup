<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Hope Prototype</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + ReactDOM (Production UMD) -->
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel for in-browser JSX (æ–¹ä¾¿æ”¹å‹•ï¼›å¦‚è¦æ›´å¿«ï¼Œå¯æ”¹æˆé å…ˆç·¨è­¯) -->
  <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body { height: 100%; }
    body {
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,0.06), transparent 50%),
        radial-gradient(900px 700px at 90% 20%, rgba(14,165,233,0.06), transparent 60%),
        #0b1020;
    }
  </style>
</head>
<body class="text-white">
  <div id="root"></div>

  <script type="text/babel" data-presets="react">
    const { useEffect, useRef, useState } = React;

    // ===== Utils =============================================================
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

    // ===== Attack types ======================================================
    const ATTACKS = {
      L: { key: 'L', label: 'Light',   accBonus: +0.10, powMul: 0.80, intMul: 0.00 },
      H: { key: 'H', label: 'Heavy',   accBonus: -0.10, powMul: 1.35, intMul: 0.00 },
      S: { key: 'S', label: 'Special', accBonus:  0.00, powMul: 0.20, intMul: 1.00 },
    };
    const FLOW_KEYS = ['L','H','S'];

    // ===== Player / Enemy ====================================================
    const DEFAULT_PLAYER = {
      name: "Jumo", job: "Kamfe", race: "Fantasy", starSigil: "Flamelion", level: 1, exp: 0, expToNext: 100,
      maxHP: 80, hp: 80, maxMP: 30, mp: 30,
      POW: 10, DEF: 5, INT: 8, DEX: 10, EVA: 5,
    };

    const BASE_ENEMY = {
      name: "Slime", maxHP: 60, hp: 60, maxMP: 10, mp: 10,
      POW: 8, DEF: 3, INT: 3, DEX: 7, EVA: 3,
    };

    // ===== Demo inventory ====================================================
    const INVENTORY_START = {
      items: [
        { id: 'potion', name: 'Potion', desc: 'å›å¾© 20 HP', qty: 5 },
        { id: 'ether',  name: 'Ether',  desc: 'å›å¾© 10 MP', qty: 3 },
        { id: 'bomb',   name: 'Bomb',   desc: 'é€ æˆ 30 å‚·å®³', qty: 1 },
      ]
    };

    // ===== Companions ========================================================
    const COMPANIONS_POOL = [
      "æ˜Ÿäº• Hoshii","ç‡åŸ Kagura","ç´—ç¾… Sara","å¤œæ¸¡ Yato","ä¼Šè“®å¨œ Elenna",
      "æ´›æ© Rorn","æ¢…å¸Œäº Mexia","ç§‘çˆ¾ç¶­æ–¯ Corvus","æ©ŸåŒ  R-Alpha","ç‘Ÿè‰äº Celia"
    ];
    const MAX_PARTY_TOTAL = 4;         // åŒ…å«ç©å®¶
    const MAX_COMPANIONS = 3;          // ç©å®¶å›ºå®š 1 ä½ï¼ŒéšŠå‹æœ€å¤š 3

    // ===== Job/Race code & Star Sigils ======================================
    const JOB_CODE = { Kamfe:'KA', Strel:'ST', Magus:'MA' };
    const RACE_CODE = { Human:'Hu', Beasts:'Be', Mechs:'Me', Deity:'De', Fantasy:'Fa', Demon:'Mo' };
    const jobCode = (u) => (JOB_CODE[u.job]||'??') + (RACE_CODE[u.race]||'??');

    const STAR_SIGILS = {
      BlazingHorn: { abbr:'BH', symbol:'â™ˆ', en:'Blazing Horn', zh:'çƒˆè§’' },
      Terrahide:   { abbr:'TH', symbol:'â™‰', en:'Terrahide',   zh:'åšåœŸ' },
      Twinshade:   { abbr:'TS', symbol:'â™Š', en:'Twinshade',   zh:'é›™å½±' },
      Shellward:   { abbr:'SW', symbol:'â™‹', en:'Shellward',   zh:'æ®¼å®ˆ' },
      Flamelion:   { abbr:'FL', symbol:'â™Œ', en:'Flamelion',   zh:'ç„°é¬ƒ' },
      Pureedge:    { abbr:'PE', symbol:'â™', en:'Pureedge',    zh:'æ·¨åˆƒ' },
      Balancewing: { abbr:'BW', symbol:'â™', en:'Balancewing', zh:'è¡¡ç¿¼' },
      Nightthorn:  { abbr:'NT', symbol:'â™', en:'Nightthorn',  zh:'æš—æ£˜' },
      Skyspear:    { abbr:'SS', symbol:'â™', en:'Skyspear',    zh:'å¤©çŸ¢' },
      Stonehoof:   { abbr:'SH', symbol:'â™‘', en:'Stonehoof',   zh:'å¶ºè¹„' },
      Dreamflow:   { abbr:'DF', symbol:'â™’', en:'Dreamflow',   zh:'å¹»æµ' },
      Tidemare:    { abbr:'TM', symbol:'â™“', en:'Tidemare',    zh:'æ½®å¤¢' },
    };

    const ROSTER_META = {
      "æ˜Ÿäº• Hoshii": { job: "Magus",  race: "Fantasy", level: 1, starSigil: "Tidemare" },
      "ç‡åŸ Kagura": { job: "Kamfe",  race: "Beasts",  level: 1, starSigil: "BlazingHorn" },
      "ç´—ç¾… Sara":   { job: "Magus",  race: "Human",   level: 1, starSigil: "Pureedge" },
      "å¤œæ¸¡ Yato":   { job: "Kamfe",  race: "Demon",   level: 1, starSigil: "Nightthorn" },
      "ä¼Šè“®å¨œ Elenna":{ job: "Strel",  race: "Deity",   level: 1, starSigil: "Skyspear" },
      "æ´›æ© Rorn":   { job: "Strel",  race: "Beasts",  level: 1, starSigil: "Terrahide" },
      "æ¢…å¸Œäº Mexia":{ job: "Kamfe",  race: "Fantasy", level: 1, starSigil: "Flamelion" },
      "ç§‘çˆ¾ç¶­æ–¯ Corvus":{ job: "Strel", race: "Demon", level: 1, starSigil: "Twinshade" },
      "æ©ŸåŒ  R-Alpha":{ job: "Magus",  race: "Mechs",   level: 1, starSigil: "Dreamflow" },
      "ç‘Ÿè‰äº Celia":{ job: "Kamfe",  race: "Human",   level: 1, starSigil: "Balancewing" },
    };

    const COMPANION_DATA = {
      "æ˜Ÿäº• Hoshii": { maxHP: 74, maxMP: 40, POW: 7,  DEF: 5, INT:12, DEX:10, EVA: 6 },
      "ç‡åŸ Kagura": { maxHP: 88, maxMP: 22, POW:12, DEF: 8, INT: 5, DEX: 9, EVA: 6 },
      "ç´—ç¾… Sara":   { maxHP: 72, maxMP: 39, POW: 6,  DEF: 5, INT:12, DEX: 9, EVA: 6 },
      "å¤œæ¸¡ Yato":   { maxHP: 86, maxMP: 24, POW:12, DEF: 7, INT: 6, DEX:10, EVA: 6 },
      "ä¼Šè“®å¨œ Elenna":{maxHP: 80, maxMP: 28, POW: 9,  DEF: 5, INT: 8, DEX:12, EVA: 8 },
      "æ´›æ© Rorn":   { maxHP: 82, maxMP: 26, POW: 9,  DEF: 6, INT: 7, DEX:11, EVA: 7 },
      "æ¢…å¸Œäº Mexia":{ maxHP: 84, maxMP: 24, POW:11, DEF: 6, INT: 7, DEX:11, EVA: 7 },
      "ç§‘çˆ¾ç¶­æ–¯ Corvus":{maxHP: 78, maxMP: 26, POW: 9, DEF: 5, INT: 8, DEX:12, EVA: 8 },
      "æ©ŸåŒ  R-Alpha":{ maxHP: 76, maxMP: 42, POW: 7,  DEF: 5, INT:12, DEX: 9, EVA: 5 },
      "ç‘Ÿè‰äº Celia":{ maxHP: 82, maxMP: 24, POW:10, DEF: 7, INT: 6, DEX:10, EVA: 6 },
    };
    function getCompanionBase(name){
      const m = ROSTER_META[name] || { job:'Kamfe', race:'Human', level:1, starSigil:'Balancewing' };
      const d = COMPANION_DATA[name] || { maxHP:76, maxMP:24, POW:8, DEF:5, INT:7, DEX:9, EVA:6 };
      return { name, ...m, ...d, hp: d.maxHP, mp: d.maxMP };
    }

    // ===== Equipment DB & helpers ===========================================
    const EQUIP_DB = {
      Weapon: [
        { name:'Bronze Sword',     mods:{ POW:+2 } },
        { name:'Hunter Bow',       mods:{ DEX:+2 } },
        { name:'Apprentice Staff', mods:{ INT:+2 } },
        { name:'Duelist Blade',    mods:{ POW:+1, DEX:+1 } },
        { name:'Heavy Axe',        mods:{ POW:+4, DEX:-1 } },
      ],
      Body: [
        { name:'Cloth Armor',  mods:{ DEF:+1 } },
        { name:'Leather Vest', mods:{ EVA:+2 } },
        { name:'Iron Mail',    mods:{ DEF:+3, DEX:-1 } },
        { name:'Mystic Robe',  mods:{ INT:+2, DEF:+1 } },
      ],
      Accessory: [
        { name:'Traveler Charm', mods:{ DEX:+1, EVA:+1 } },
        { name:'Power Ring',     mods:{ POW:+2 } },
        { name:'Mind Pendant',   mods:{ INT:+2 } },
        { name:'Guardian Band',  mods:{ DEF:+2 } },
      ],
    };
    const getEquipItem = (slot, name) => (EQUIP_DB[slot]||[]).find(it=>it.name===name)||null;
    const applyMods = (base, mods) => {
      const out = { ...base };
      ['POW','DEF','INT','DEX','EVA'].forEach(k => { const v = (mods?.[k]||0); out[k] = clamp((out[k]||0)+v,1,999); });
      return out;
    };
    const getPlayerEffective = (p) => {
      const gear = p.equip || {};
      let eff = { ...p };
      const w = getEquipItem('Weapon', gear.Weapon);
      const b = getEquipItem('Body', gear.Body);
      const a = getEquipItem('Accessory', gear.Accessory);
      if (w) eff = applyMods(eff, w.mods);
      if (b) eff = applyMods(eff, b.mods);
      if (a) eff = applyMods(eff, a.mods);
      return eff;
    };
    const modsToText = (mods) => {
      if(!mods) return '';
      const parts=[];
      for (const k of ['POW','DEF','INT','DEX','EVA']) if (mods[k]) parts.push(`${mods[k]>0?'+':''}${mods[k]} ${k}`);
      return parts.join(', ');
    };

    // ===== Combat helpers ====================================================
    const baseAcc = (att, def) => clamp(0.60 + 0.02 * (att.DEX - def.EVA), 0.05, 0.95);
    const hitChance = (att, def, atkType, stepIndex) => {
      const stepBonus = stepIndex === 0 ? 0 : stepIndex === 1 ? 0.10 : 0.20;
      const typeBonus = ATTACKS[atkType].accBonus;
      return clamp(baseAcc(att, def) + typeBonus + stepBonus, 0.05, 0.98);
    };
    const rollDamage = (att, def, atkType) => {
      const spec = ATTACKS[atkType];
      const raw = spec.powMul * att.POW + spec.intMul * att.INT;
      let dmg = Math.round(raw + randInt(-1, 2));
      dmg = Math.max(1, dmg - Math.round(def.DEF * 0.5));
      return dmg;
    };

    // ===== UI bits ===========================================================
    const HPBar = ({ label, current, max, color }) => {
      const pct = Math.max(0, Math.round((current/max)*100));
      return (
        <div className="w-full">
          <div className="flex justify-between text-xs text-gray-400 mb-1">
            <span>{label}</span><span>{current}/{max}</span>
          </div>
          <div className="h-3 w-full bg-gray-800/60 rounded-full overflow-hidden">
            <div className={`h-full ${color} transition-all duration-300`} style={{width: `${pct}%`}}/>
          </div>
        </div>
      );
    };
    const StatRow = ({ unit }) => (
      <div className="mt-3 text-sm text-white/80">
        POW {unit.POW} Â· DEF {unit.DEF} Â· INT {unit.INT} Â· DEX {unit.DEX} Â· EVA {unit.EVA}
      </div>
    );
    const Card = ({children, className=""}) => (<div className={`rounded-2xl bg-gray-900/60 border border-white/10 shadow-xl p-5 ${className}`}>{children}</div>);
    const Divider = () => <div className="h-px bg-white/10 my-4" />;
    const useAutoscroll = (dep) => { const ref=useRef(null); useEffect(()=>{ if(ref.current) ref.current.scrollTop = ref.current.scrollHeight; },[dep]); return ref; };
    const FlowButton = ({ value, onChange }) => {
      const cycle = () => { const i = FLOW_KEYS.indexOf(value); onChange(FLOW_KEYS[(i + 1) % FLOW_KEYS.length]); };
      const text = value === 'L' ? 'L è¼•' : value === 'H' ? 'H é‡' : 'S ç‰¹';
      return (<button onClick={cycle} className="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition">{text}</button>);
    };
    const FullCenter = ({children}) => (<div className="min-h-[70vh] flex items-center justify-center">{children}</div>);

    // ==== Equip UI ===========================================================
    const EquipSelect = ({ slot, value, onChange }) => {
      const list = EQUIP_DB[slot] || [];
      const idx = Math.max(0, list.findIndex(it => it.name === value));
      const prev = () => onChange(list[(idx - 1 + list.length) % list.length].name);
      const next = () => onChange(list[(idx + 1) % list.length].name);
      const cur = list[idx] || null;
      return (
        <div className="flex items-center justify-between bg-white/5 rounded-xl p-3">
          <div>
            <div className="text-sm font-semibold">{slot}</div>
            <div className="text-sm">{cur ? cur.name : value}</div>
            <div className="text-xs text-white/60">{cur ? modsToText(cur.mods) : ""}</div>
          </div>
          <div className="flex gap-2">
            <button onClick={prev} className="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/15">â€¹</button>
            <button onClick={next} className="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/15">â€º</button>
          </div>
        </div>
      );
    };
    const EquipPanel = ({ gear, onChange }) => (
      <div className="grid gap-3 md:grid-cols-3">
        <EquipSelect slot="Weapon" value={gear.Weapon} onChange={(v)=>onChange('Weapon', v)} />
        <EquipSelect slot="Body" value={gear.Body} onChange={(v)=>onChange('Body', v)} />
        <EquipSelect slot="Accessory" value={gear.Accessory} onChange={(v)=>onChange('Accessory', v)} />
      </div>
    );

    // ===== Enemy scaling =====================================================
    const makeEnemyForRoom = (idx, diff, total) => {
      const diffMul = diff === 'Normal' ? 0.9 : diff === 'Hard' ? 1.1 : 1.3;
      const roomGrowth = 1 + (idx - 1) * 0.08;
      const elite = (diff === 'Hard' && idx === total);
      const boss = (diff === 'VeryHard' && idx === total);
      const mul = diffMul * roomGrowth * (elite ? 1.25 : 1) * (boss ? 1.6 : 1);
      const name = boss ? 'Evil Tuma' : elite ? 'Elite Slime' : BASE_ENEMY.name;
      const hp = Math.round(BASE_ENEMY.maxHP * mul);
      const mp = Math.round(BASE_ENEMY.maxMP * Math.max(1, mul * 0.6));
      return {
        ...BASE_ENEMY, name,
        maxHP: hp, hp, maxMP: mp, mp,
        POW: Math.round(BASE_ENEMY.POW * mul),
        DEF: Math.round(BASE_ENEMY.DEF * mul),
        INT: Math.round(BASE_ENEMY.INT * mul),
        DEX: Math.round(BASE_ENEMY.DEX * mul),
        EVA: Math.round(BASE_ENEMY.EVA * mul),
      };
    };
    const randomFlow = () => { const pick = () => FLOW_KEYS[randInt(0, FLOW_KEYS.length - 1)]; return [pick(), pick(), pick()]; };

    // ===== App ===============================================================
    function App(){
      const [screen, setScreen] = useState("title"); // title | main | quest | prepare | battle | result | status | inventory | companions | relay | settings
      const [player, setPlayer] = useState(() => ({ ...DEFAULT_PLAYER, equip: { Weapon: 'Bronze Sword', Body: 'Cloth Armor', Accessory: 'Traveler Charm' } }));
      const [inventory] = useState(INVENTORY_START);
      const [party, setParty] = useState([]);
      const [compUnits, setCompUnits] = useState({});
      const [compFlows, setCompFlows] = useState({});

      const [difficulty, setDifficulty] = useState(null);
      const [totalRooms, setTotalRooms] = useState(0);
      const [roomIndex, setRoomIndex] = useState(0);
      const [enemy, setEnemy] = useState(() => makeEnemyForRoom(1, 'Normal', 3));

      const [logs, setLogs] = useState([]); const logRef = useAutoscroll(logs);
      const [busy, setBusy] = useState(false);
      const [result, setResult] = useState(null);
      const [backTo, setBackTo] = useState(null);

      const [playerFlow, setPlayerFlow] = useState(['L','H','S']);
      const [enemyFlow, setEnemyFlow]   = useState(randomFlow());

      // Navigation
      const goMain = () => {
        // å›ä¸»ç•«é¢ï¼šå…¨éšŠå›æ»¿
        setPlayer(prev => ({ ...prev, hp: prev.maxHP, mp: prev.maxMP }));
        setCompUnits(prev => {
          const copy = { ...prev };
          Object.keys(copy).forEach(n => { copy[n] = { ...copy[n], hp: copy[n].maxHP, mp: copy[n].maxMP }; });
          return copy;
        });
        setScreen('main');
      };
      const goQuest = () => setScreen('quest');
      const goInventory = () => setScreen('inventory');
      const goSettings = () => setScreen('settings');
      const goRelay = () => setScreen('relay');
      const goStatus = (from=null) => { setBackTo(from); setScreen('status'); };
      const startFromTitle = () => setScreen('main');

      // Quest select
      const chooseQuest = (diff) => {
        const cfg = diff === 'Normal' ? 3 : diff === 'Hard' ? 5 : 7;
        setDifficulty(diff); setTotalRooms(cfg); setRoomIndex(1);
        setEnemy(makeEnemyForRoom(1, diff, cfg)); setEnemyFlow(randomFlow());
        const units = {}, flows = {};
        party.forEach(n => { const b = getCompanionBase(n); units[n] = { ...b }; flows[n] = randomFlow(); });
        setCompUnits(units); setCompFlows(flows);
        setLogs([]); setBusy(false);
        setScreen('prepare');
      };
      const enterNextRoom = () => { if (!difficulty) return; setScreen('battle'); };

      // Battle loop
      useEffect(() => {
        if (screen !== 'battle' || busy) return;
        let cancelled = false;
        (async () => {
          setBusy(true);
          let eHP = enemy.hp;
          let pHP = player.hp;
          let cHP = Object.fromEntries(party.map(n => [n, (compUnits[n]?.hp ?? getCompanionBase(n).maxHP)]));

          const alliesAlive = () => ['player', ...party].filter(id => id === 'player' ? pHP > 0 : (cHP[id] ?? 0) > 0);
          const dexOf = (id) => id === 'enemy' ? enemy.DEX : (id === 'player' ? getPlayerEffective(player).DEX : (compUnits[id]?.DEX ?? getCompanionBase(id).DEX));
          const unitOf = (id) => id === 'enemy' ? enemy : (id === 'player' ? getPlayerEffective(player) : (compUnits[id] || getCompanionBase(id)));
          const nameOf = (id) => {
            if (id === 'enemy') return enemy.name;
            const u = unitOf(id);
            return id === 'player'
              ? `Jumo (${jobCode(u)} Lv${u.level}) Â· ${STAR_SIGILS[u.starSigil]?.abbr} ${STAR_SIGILS[u.starSigil]?.symbol}`
              : `${u.name} (${jobCode(u)} Lv${u.level}) Â· ${STAR_SIGILS[u.starSigil]?.abbr} ${STAR_SIGILS[u.starSigil]?.symbol}`;
          };
          const flowOf = (id) => id === 'enemy' ? enemyFlow : (id === 'player' ? playerFlow : (compFlows[id] || ['L','H','S']));

          while (!cancelled && eHP > 0 && alliesAlive().length > 0) {
            const order = [...alliesAlive(), 'enemy'].sort((a,b)=> dexOf(b) - dexOf(a));
            for (const id of order) {
              if (cancelled) break;
              if (id === 'enemy' && eHP <= 0) continue;
              if (id !== 'enemy') {
                if (id === 'player' && pHP <= 0) continue;
                if (id !== 'player' && (cHP[id] ?? 0) <= 0) continue;
              }
              const attacker = unitOf(id);
              const flow = flowOf(id);
              for (let i = 0; i < 3; i++) {
                await sleep(140);
                if (id === 'enemy') {
                  const candidates = alliesAlive();
                  if (candidates.length === 0) break;
                  const targetId = candidates[randInt(0, candidates.length - 1)];
                  const target = unitOf(targetId);
                  const acc = hitChance(attacker, target, flow[i], i);
                  if (Math.random() < acc) {
                    const dmg = rollDamage(attacker, target, flow[i]);
                    if (targetId === 'player') {
                      pHP = Math.max(0, pHP - dmg); setPlayer(prev => ({ ...prev, hp: pHP }));
                    } else {
                      const nhp = Math.max(0, (cHP[targetId] ?? 0) - dmg); cHP[targetId] = nhp;
                      setCompUnits(prev => ({ ...prev, [targetId]: { ...(prev[targetId] || getCompanionBase(targetId)), hp: nhp } }));
                    }
                    setLogs(prev => [...prev, `${attacker.name} [${flow[i]}] å‘½ä¸­ï¼Œå° ${nameOf(targetId)} é€ æˆ ${dmg} å‚·å®³ï¼ˆå‘½ä¸­ç‡ ${Math.round(acc*100)}%ï¼‰`].slice(-160));
                  } else {
                    setLogs(prev => [...prev, `${attacker.name} [${flow[i]}] çš„æ”»æ“Šè½ç©º`].slice(-160));
                  }
                } else {
                  const acc = hitChance(attacker, enemy, flow[i], i);
                  if (Math.random() < acc) {
                    const dmg = rollDamage(attacker, enemy, flow[i]);
                    eHP = Math.max(0, eHP - dmg); setEnemy(prev => ({ ...prev, hp: eHP }));
                    setLogs(prev => [...prev, `${nameOf(id)} [${flow[i]}] å‘½ä¸­ï¼Œé€ æˆ ${dmg} å‚·å®³ï¼ˆå‘½ä¸­ç‡ ${Math.round(acc*100)}%ï¼‰`].slice(-160));
                  } else {
                    setLogs(prev => [...prev, `${nameOf(id)} [${flow[i]}] æœªå‘½ä¸­ï¼ˆå‘½ä¸­ç‡ ${Math.round(acc*100)}%ï¼‰`].slice(-160));
                  }
                }
                await sleep(100);
                if (eHP <= 0 || alliesAlive().length === 0) break;
              }
              if (eHP <= 0 || alliesAlive().length === 0) break;
            }
          }

          if (!cancelled) {
            if (eHP <= 0) {
              awardExp(diffExp(difficulty));
              recoverBetweenRooms();
              if (roomIndex < totalRooms) {
                const nextIdx = roomIndex + 1;
                setRoomIndex(nextIdx);
                setEnemy(makeEnemyForRoom(nextIdx, difficulty, totalRooms));
                setEnemyFlow(randomFlow());
                setScreen('prepare');
                setLogs(prev => [...prev, `âœ” æ¸…ç©ºæˆ¿é–“ ${roomIndex}ï¼Œæº–å‚™é€²å…¥æˆ¿é–“ ${roomIndex+1}`].slice(-160));
              } else {
                setResult({ title: 'Victory', desc: `${difficulty} åœ°åŸå·²å®Œå…¨æ”»ç•¥ï¼` });
                setScreen('result');
              }
            } else if (alliesAlive().length === 0) {
              setResult({ title: 'Defeat', desc: `éšŠä¼å…¨æ»…ï¼Œå€’åœ¨æˆ¿é–“ ${roomIndex}ï¼ˆ${difficulty}ï¼‰ã€‚` });
              setScreen('result');
            }
          }
          setBusy(false);
        })();
        return () => { cancelled = true; };
      }, [screen]);

      // Exp / recovery
      function awardExp(amount) {
        setPlayer(prev => {
          let exp = prev.exp + amount, level = prev.level, expToNext = prev.expToNext;
          let maxHP = prev.maxHP, hp = prev.hp, maxMP = prev.maxMP, mp = prev.mp;
          while (exp >= expToNext) {
            exp -= expToNext; level += 1; expToNext = 100 + level * 20;
            maxHP += 6; hp = Math.min(maxHP, hp + 6);
            maxMP += 3; mp = Math.min(maxMP, mp + 3);
          }
          return { ...prev, exp, level, expToNext, maxHP, hp, maxMP, mp };
        });
      }
      const diffExp = (diff) => diff === 'Normal' ? 10 : diff === 'Hard' ? 18 : 28;
      function recoverBetweenRooms() {
        setPlayer(prev => {
          const hpRec = Math.ceil(prev.maxHP * 0.08);
          const mpRec = Math.ceil(prev.maxMP * 0.08);
          return { ...prev, hp: Math.min(prev.maxHP, prev.hp + hpRec), mp: Math.min(prev.maxMP, prev.mp + mpRec) };
        });
        setCompUnits(prev => {
          const copy = { ...prev };
          Object.keys(copy).forEach(n => {
            const u = copy[n] || getCompanionBase(n);
            const hpRec = Math.ceil(u.maxHP * 0.08);
            const mpRec = Math.ceil(u.maxMP * 0.08);
            copy[n] = { ...u, hp: Math.min(u.maxHP, (u.hp ?? u.maxHP) + hpRec), mp: Math.min(u.maxMP, (u.mp ?? u.maxMP) + mpRec) };
          });
          return copy;
        });
      }

      // ===== Screens =========================================================
      const Title = () => (
        <FullCenter>
          <Card className="w-full max-w-xl text-center">
            <div className="text-3xl font-bold mb-2">Project Hope Prototype</div>
            <div className="opacity-80 mb-6">gameflow ç¢ºèª</div>
            <button onClick={startFromTitle} className="px-6 py-3 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition font-medium w-full">Start</button>
          </Card>
        </FullCenter>
      );

      const Main = () => (
        <div className="space-y-4">
          <div className="flex justify-end gap-2">
            <button onClick={()=>goStatus('main')} className="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-sm">è§’è‰²</button>
            <button onClick={goInventory} className="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-sm">èƒŒåŒ…</button>
            <button onClick={goSettings} className="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-sm">è¨­å®š</button>
          </div>
          <div className="grid gap-3 sm:grid-cols-2 md:grid-cols-3">
            <button disabled className="h-24 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-lg font-semibold disabled:opacity-60 disabled:cursor-not-allowed">æ˜Ÿè±¡æ®¿å ‚</button>
            <button onClick={goQuest} className="h-24 rounded-2xl bg-indigo-500/90 hover:bg-indigo-500 flex items-center justify-center text-lg font-semibold">å¸ƒå‘Šæ¬„</button>
            <button onClick={goRelay} className="h-24 rounded-2xl bg-purple-500/90 hover:bg-purple-500 flex itemsä¸­å¿ƒ justify-center text-lg font-semibold">é€£çµä¸­ç¹¼ç«™</button>
            <button disabled className="h-24 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-lg font-semibold disabled:opacity-60 disabled:cursor-not-allowed">è³‡æºæ¨¡æ“¬å ´</button>
            <button disabled className="h-24 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-lg font-semibold disabled:opacity-60 disabled:cursor-not-allowed">è£å‚™èˆ–</button>
            <button disabled className="h-24 rounded-2xl bgç™½/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-lg font-semibold disabled:opacity-60 disabled:cursor-not-allowed">å¼·åŒ–èˆ–</button>
            <button disabled className="h-24 rounded-2xl bg-white/5 hover:bg-white/10 border border-white/10 flex items-center justify-center text-lg font-semibold disabled:opacity-60 disabled:cursor-not-allowed">å€‰åº«</button>
          </div>
          <Card className="mt-1">
            <div className="text-sm font-semibold mb-2">ç›®å‰éšŠä¼ï¼ˆå«ç©å®¶æœ€å¤š 4 äººï¼‰ï¼šå·²é¸ {1 + party.length}/4</div>
            <div className="flex flex-wrap gap-2">
              <span className="inline-block font-mono bg-white/10 rounded px-2 py-0.5">Jumo ({jobCode(player)} Lv{player.level}) Â· {STAR_SIGILS[player.starSigil]?.abbr} {STAR_SIGILS[player.starSigil]?.symbol}</span>
              {party.length === 0 ? (
                <span className="text-white/60 text-sm">ï¼ˆå°šç„¡éšŠå‹ï¼‰</span>
              ) : (
                party.map(n => (
                  <span key={n} className="inline-block font-mono bg-white/10 rounded px-2 py-0.5">
                    {`${n} (${jobCode(ROSTER_META[n])} Lv${ROSTER_META[n].level}) Â· ${STAR_SIGILS[ROSTER_META[n].starSigil]?.abbr} ${STAR_SIGILS[ROSTER_META[n].starSigil]?.symbol}`}
                  </span>
                ))
              )}
            </div>
          </Card>
        </div>
      );

      const Quest = () => (
        <div className="grid gap-4 md:grid-cols-3">
          <Card><div className="text-lg font-semibold mb-2">Normal</div>
            <p className="text-sm textç™½/80">3 å€‹æˆ¿é–“ Â· æ€ªç‰©å¼±å°</p><Divider/>
            <button onClick={()=>chooseQuest('Normal')} className="px-4 py-2 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition font-medium w-full">é–‹å§‹</button></Card>
          <Card><div className="text-lg font-semibold mb-2">Hard</div>
            <p className="text-sm text-white/80">5 å€‹æˆ¿é–“ Â· æ€ªç‰©ä¸­ç­‰ï¼Œæœ€çµ‚æˆ¿ç‚ºç²¾è‹±</p><Divider/>
            <button onClick={()=>chooseQuest('Hard')} className="px-4 py-2 rounded-xl bg-amber-500/90 hover:bg-amber-500 transition font-medium w-full">é–‹å§‹</button></Card>
          <Card><div className="text-lg font-semibold mb-2">VeryHard</div>
            <p className="text-sm text-white/80">7 å€‹æˆ¿é–“ Â· æœ€çµ‚ Bossï¼šEvil Tuma</p><Divider/>
            <button onClick={()=>chooseQuest('VeryHard')} className="px-4 py-2 rounded-xl bg-rose-500/90 hover:bg-rose-500 transition font-medium w-full">é–‹å§‹</button></Card>
        </div>
      );

      const Prepare = () => (
        <div className="grid gap-4 md:grid-cols-3">
          <Card><div className="text-lg font-semibold mb-3">ğŸ§‘ æˆ‘æ–¹éšŠä¼</div>
            <div className="space-y-3">
              <div>
                <div className="font-semibold">Jumo ({jobCode(player)} Lv{player.level}) Â· {STAR_SIGILS[player.starSigil]?.abbr} {STAR_SIGILS[player.starSigil]?.symbol}</div>
                <HPBar label="HP" current={player.hp} max={player.maxHP} color="bg-emerald-500" />
                <div className="mt-2" />
                <HPBar label="MP" current={player.mp} max={player.maxMP} color="bg-sky-500" />
                <StatRow unit={getPlayerEffective(player)} />
              </div>
              {party.map(n => { const u = compUnits[n] || getCompanionBase(n); return (
                <div key={n} className="pt-2 border-t border-white/10">
                  <div className="font-semibold">{u.name} ({jobCode(u)} Lv{u.level}) Â· {STAR_SIGILS[u.starSigil]?.abbr} {STAR_SIGILS[u.starSigil]?.symbol}</div>
                  <HPBar label="HP" current={u.hp ?? u.maxHP} max={u.maxHP} color="bg-emerald-500" />
                  <div className="mt-2" />
                  <HPBar label="MP" current={u.mp ?? u.maxMP} max={u.maxMP} color="bg-sky-500" />
                  <StatRow unit={u} />
                </div>
              ); })}
            </div>
          </Card>
          <Card><div className="text-lg font-semibold mb-1">ğŸ› ï¸ æº–å‚™éšæ®µ</div>
            <div className="text-sm text-white/70">é›£åº¦ <span className="font-semibold">{difficulty}</span> Â· æˆ¿é–“ {roomIndex}/{totalRooms}</div>
            <div className="text-xs text-white/60">å‘½ä¸­åŠ æˆï¼šç¬¬1ä¸‹ +0%ï¼Œç¬¬2ä¸‹ +10%ï¼Œç¬¬3ä¸‹ +20%</div><Divider/>
            <div className="text-sm mb-2">ç©å®¶æ”»æ“Šæµç¨‹ï¼š</div>
            <div className="flex gap-2">{playerFlow.map((v,idx)=> (<FlowButton key={idx} value={v} onChange={(nv)=> setPlayerFlow(f => f.map((x,i)=> i===idx?nv:x))} />))}</div>
            <div className="text-xs text-white/60 mt-2">æç¤ºï¼šæŠŠ H æ”¾åˆ°ç¬¬ä¸‰ä¸‹ï¼Œäº«å—è¼ƒé«˜å‘½ä¸­åŠ æˆã€‚</div><Divider/>
            <div className="flex gap-2">
              <button onClick={enterNextRoom} className="px-4 py-2 rounded-xl bg-indigo-500/90 hover:bg-indigo-500 transition font-medium">é€²å…¥ä¸‹ä¸€å€‹æˆ¿é–“</button>
              <button onClick={()=>goStatus('prepare')} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è£å‚™ç®¡ç†</button>
            </div>
            <div className="text-xs text-white/50 mt-2">ï¼ˆæŒ‰ä¸‹å¾Œå°‡é–‹å§‹è‡ªå‹•æˆ°é¬¥ï¼‰</div>
            <Divider/>
            <div className="text-sm font-semibold mb-2">ğŸ§¾ æˆ°é¬¥ç´€éŒ„ï¼ˆä¸Šä¸€æˆ¿ / é€²è¡Œä¸­ï¼‰</div>
            <div ref={logRef} className="h-40 overflow-auto rounded-xl bg-black/30 p-3 text-sm leading-relaxed">
              {logs.length === 0 ? <div className="opacity-50">ï¼ˆå°šç„¡ç´€éŒ„ï¼‰</div> : logs.map((l,i)=>(<div key={i} className="mb-1">â€¢ {l}</div>))}
            </div></Card>
          <Card><div className="text-lg font-semibold mb-3">ğŸ‘¾ ä¸‹ä¸€å€‹æ•µäººï¼š{enemy.name}</div>
            <HPBar label="HP" current={enemy.maxHP} max={enemy.maxHP} color="bg-rose-500" /><div className="mt-2" />
            <HPBar label="MP" current={enemy.maxMP} max={enemy.maxMP} color="bg-sky-500" />
            <StatRow unit={enemy} /><Divider/>
            <div className="text-sm">æ•µæ–¹æµç¨‹ï¼ˆéš¨æ©Ÿï¼‰ï¼š <span className="ml-2 font-mono bg-white/10 rounded px-2 py-0.5">{enemyFlow.join(' - ')}</span></div></Card>
        </div>
      );

      const Battle = () => (
        <div className="grid gap-4 md:grid-cols-3">
          <Card><div className="text-lg font-semibold mb-3">ğŸ§‘ æˆ‘æ–¹éšŠä¼</div>
            <div className="space-y-3">
              <div>
                <div className="font-semibold">Jumo ({jobCode(player)} Lv{player.level}) Â· {STAR_SIGILS[player.starSigil]?.abbr} {STAR_SIGILS[player.starSigil]?.symbol}</div>
                <HPBar label="HP" current={player.hp} max={player.maxHP} color="bg-emerald-500" />
                <div className="mt-2" />
                <HPBar label="MP" current={player.mp} max={player.maxMP} color="bg-sky-500" />
                <StatRow unit={getPlayerEffective(player)} />
              </div>
              {party.map(n => { const u = compUnits[n] || getCompanionBase(n); return (
                <div key={n} className="pt-2 border-t border-white/10">
                  <div className="font-semibold">{u.name} ({jobCode(u)} Lv{u.level}) Â· {STAR_SIGILS[u.starSigil]?.abbr} {STAR_SIGILS[u.starSigil]?.symbol}</div>
                  <HPBar label="HP" current={u.hp ?? u.maxHP} max={u.maxHP} color="bg-emerald-500" />
                  <div className="mt-2" />
                  <HPBar label="MP" current={u.mp ?? u.maxMP} max={u.maxMP} color="bg-sky-500" />
                  <StatRow unit={u} />
                </div>
              ); })}
            </div>
          </Card>
          <Card><div className="text-lg font-semibold mb-1">âš”ï¸ æˆ°é¬¥ä¸­</div>
            <div className="text-sm text-white/70">{difficulty} Â· æˆ¿é–“ {roomIndex}/{totalRooms} Â· ç©å®¶æµç¨‹: <span className="ml-2 font-mono bg-white/10 rounded px-2 py-0.5">{playerFlow.join(' - ')}</span></div>
            <div className="text-sm text-white/70">æ•µäººæµç¨‹: <span className="ml-2 font-mono bg-white/10 rounded px-2 py-0.5">{enemyFlow.join(' - ')}</span></div>
            <Divider/>
            <div ref={logRef} className="h-56 overflow-auto rounded-xl bg-black/30 p-3 text-sm leading-relaxed">
              {logs.length === 0 ? <div className="opacity-50">è‡ªå‹•æˆ°é¬¥ä¸­â€¦</div> : logs.map((l,i)=>(<div key={i} className="mb-1">â€¢ {l}</div>))}
            </div><Divider/>
            <div className="flex justify-between">
              <button onClick={goMain} className="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition">å›ä¸»ç•«é¢</button>
              <div className="text-xs text-white/60 self-center">æ¯å›åˆé€£æ‰“ 3 æ¬¡ï¼ˆå‘½ä¸­é€æ¬¡ä¸Šå‡ï¼‰</div>
            </div></Card>
          <Card><div className="text-lg font-semibold mb-3">ğŸ‘¾ {enemy.name}</div>
            <HPBar label="HP" current={enemy.hp} max={enemy.maxHP} color="bg-rose-500" /><div className="mt-2" />
            <HPBar label="MP" current={enemy.mp} max={enemy.maxMP} color="bg-sky-500" />
            <StatRow unit={enemy} /></Card>
        </div>
      );

      const Status = () => {
        const pct = Math.round((player.exp / player.expToNext) * 100);
        const gear = player.equip || { Weapon:'Bronze Sword', Body:'Cloth Armor', Accessory:'Traveler Charm' };
        const pEff = getPlayerEffective(player);
        return (
          <Card className="max-w-3xl">
            <div className="text-lg font-semibold mb-2">ğŸ§‘ è§’è‰²ç‹€æ…‹</div>
            <div className="text-sm">åç¨±ï¼šJumo ({jobCode(player)} Lv{player.level}) Â· {STAR_SIGILS[player.starSigil]?.abbr} {STAR_SIGILS[player.starSigil]?.symbol}</div>
            <div className="mt-3" />
            <HPBar label="HP" current={player.hp} max={player.maxHP} color="bg-emerald-500" />
            <div className="mt-2" />
            <HPBar label="MP" current={player.mp} max={player.maxMP} color="bg-sky-500" />
            <StatRow unit={pEff} />
            <Divider/>
            <div className="text-lg font-semibold mb-2">ğŸ§° è£å‚™</div>
            <EquipPanel gear={gear} onChange={(slot,newName)=> setPlayer(prev => ({ ...prev, equip: { ...prev.equip, [slot]: newName } }))} />
            <div className="text-sm text-white/70 mt-3">è£å‚™åŠ æˆï¼š
              <span className="ml-2 font-mono bg-white/10 rounded px-2 py-0.5">
                {['Weapon','Body','Accessory'].map(s=>modsToText(getEquipItem(s, gear[s])?.mods)).filter(Boolean).join(' ï½œ ')}
              </span>
            </div>
            <Divider/>
            <div className="text-sm">å‡ç´šé€²åº¦ï¼š{player.exp}/{player.expToNext} EXPï¼ˆå‰©é¤˜ {Math.max(0, player.expToNext - player.exp)}ï¼‰</div>
            <div className="h-2 bg-white/10 rounded mt-2 overflow-hidden"><div className="h-full bg-amber-400" style={{width: `${pct}%`}}/></div>
            <Divider/>
            <button onClick={()=> setScreen(backTo || 'main')} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è¿”å›</button>
          </Card>
        );
      };

      const Inventory = () => (
        <Card className="max-w-4xl">
          <div className="text-lg font-semibold mb-2">ğŸ’ èƒŒåŒ…</div>
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <div className="font-semibold mb-2">é“å…·</div>
              {inventory.items.length === 0 ? <div className="text-white/60 text-sm">ï¼ˆç©ºï¼‰</div> :
                <ul className="space-y-2">{inventory.items.map(it => (
                  <li key={it.id} className="flex justify-between bg-white/5 rounded-lg px-3 py-2 text-sm"><span>{it.name} <span className="text-white/50">â€” {it.desc}</span></span><span className="font-mono">Ã—{it.qty}</span></li>
                ))}</ul>}
            </div>
            <div>
              <div className="font-semibold mb-2">è£å‚™ï¼ˆå±•ç¤ºç”¨ï¼Œè«‹åˆ°ã€Œè§’è‰²ã€èª¿æ•´ï¼‰</div>
              <ul className="space-y-2">
                <li className="flex justify-between bg-white/5 rounded-lg px-3 py-2 text-sm"><span>Weapon</span><span className="text-white/60">{player.equip?.Weapon}</span></li>
                <li className="flex justify-between bg-white/5 rounded-lg px-3 py-2 text-sm"><span>Body</span><span className="text-white/60">{player.equip?.Body}</span></li>
                <li className="flex justify-between bg-white/5 rounded-lg px-3 py-2 text-sm"><span>Accessory</span><span className="text-white/60">{player.equip?.Accessory}</span></li>
              </ul>
            </div>
          </div>
          <Divider/>
          <button onClick={goMain} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è¿”å›ä¸»ç•«é¢</button>
        </Card>
      );

      const Companions = () => {
        const toggle = (name) => { setParty(p => p.includes(name) ? p.filter(n=>n!==name) : [...p, name]); };
        return (
          <Card className="max-w-3xl">
            <div className="text-lg font-semibold mb-2">ğŸ‘¥ åŒä¼´åˆ—è¡¨</div>
            <div className="text-sm text-white/70 mb-2">é»æ“ŠåŠ å…¥/ç§»é™¤ï¼ˆç¤ºæ„ï¼‰ã€‚</div>
            <div className="flex flex-wrap gap-2 mb-4">
              {COMPANIONS_POOL.map(n => (
                <button key={n} onClick={()=>toggle(n)} className={`px-3 py-1.5 rounded-full border ${party.includes(n)?'border-emerald-400 bg-emerald-400/10':'border-white/15 bg-white/5 hover:bg-white/10'} transition`}>
                  {`${n} (${jobCode(ROSTER_META[n])} Lv${ROSTER_META[n].level}) Â· ${STAR_SIGILS[ROSTER_META[n].starSigil]?.abbr} ${STAR_SIGILS[ROSTER_META[n].starSigil]?.symbol}`}
                </button>
              ))}
            </div>
            <div className="text-sm">ç›®å‰éšŠä¼ï¼š{party.length === 0 ? <span className="text-white/60">ï¼ˆç„¡ï¼‰</span> : party.map(n => (<span key={n} className="inline-block font-mono bg-white/10 rounded px-2 py-0.5 mr-1">{`${n} (${jobCode(ROSTER_META[n])} Lv${ROSTER_META[n].level}) Â· ${STAR_SIGILS[ROSTER_META[n].starSigil]?.abbr} ${STAR_SIGILS[ROSTER_META[n].starSigil]?.symbol}`}</span>))}</div>
            <Divider/>
            <button onClick={goMain} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è¿”å›ä¸»ç•«é¢</button>
          </Card>
        );
      };

      const Relay = () => {
        const maxReached = party.length >= MAX_COMPANIONS;
        const toggle = (name) => {
          setParty(prev => prev.includes(name)
            ? prev.filter(n => n !== name)
            : (prev.length >= MAX_COMPANIONS ? prev : [...prev, name])
          );
        };
        return (
          <Card className="max-w-3xl">
            <div className="text-lg font-semibold mb-2">ğŸ”— é€£çµä¸­ç¹¼ç«™</div>
            <div className="text-sm text-white/70 mb-2">é¸æ“‡éšŠå‹åŠ å…¥éšŠä¼ï¼ˆå«ç©å®¶æœ€å¤š 4 äººï¼‰ï¼šç›®å‰ <span className="font-semibold">{1 + party.length}/4</span></div>
            <div className="flex flex-wrap gap-2 mb-3">
              {COMPANIONS_POOL.map(n => {
                const selected = party.includes(n);
                const disabled = !selected && maxReached;
                return (
                  <button key={n} onClick={() => !disabled && toggle(n)}
                    className={`px-3 py-1.5 rounded-full border ${selected
                      ? 'border-emerald-400 bg-emerald-400/10'
                      : disabled
                        ? 'border-white/10 bg-white/5 opacity-50 cursor-not-allowed'
                        : 'border-white/15 bg-white/5 hover:bg-white/10'}`}>
                      {`${n} (${jobCode(ROSTER_META[n])} Lv${ROSTER_META[n].level}) Â· ${STAR_SIGILS[ROSTER_META[n].starSigil]?.abbr} ${STAR_SIGILS[ROSTER_META[n].starSigil]?.symbol}`}
                  </button>
                );
              })}
            </div>
            {maxReached && <div className="text-xs text-white/60 mb-2">å·²é”ä¸Šé™ï¼ˆåŒ…å«ç©å®¶ Jumo æœ€å¤š 4 äººï¼‰ã€‚è«‹å…ˆç§»é™¤ä¸€ä½å†åŠ å…¥ã€‚</div>}
            <Divider/>
            <button onClick={goMain} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è¿”å›ä¸»ç•«é¢</button>
          </Card>
        );
      };

      const Settings = () => (
        <Card className="max-w-3xl">
          <div className="text-lg font-semibold mb-2">âš™ï¸ è¨­å®š</div>
          <div className="text-white/70 text-sm">å°šæœªé–‹æ”¾ï¼Œåƒ…ä½”ä½ã€‚</div>
          <Divider/>
          <button onClick={goMain} className="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 transition font-medium">è¿”å›ä¸»ç•«é¢</button>
        </Card>
      );

      const Result = () => (
        <FullCenter>
          <Card className="w-full max-w-xl text-center">
            <div className="text-3xl font-bold mb-2">{result?.title}</div>
            <div className="opacity-80 mb-6">{result?.desc}</div>
            <div className="flex gap-2">
              <button onClick={goMain} className="px-6 py-3 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition font-medium w-full">å›ä¸»ç•«é¢</button>
            </div>
          </Card>
        </FullCenter>
      );

      return (
        <div className="p-6 max-w-6xl mx-auto text-white">
          <div className="mb-6 flex items-center justify-between">
            <h1 className="text-2xl font-bold tracking-tight">Project Hope Prototype</h1>
            <div className="text-sm text-white/50">gameflow ç¢ºèª Â· å¸ƒå‘Šæ¬„â†’ä»»å‹™é›£åº¦ Â· å³ä¸Šï¼šè§’è‰²/èƒŒåŒ…/è¨­å®š</div>
          </div>

          {screen === 'title' && <Title/>}
          {screen === 'main' && <Main/>}
          {screen === 'quest' && <Quest/>}
          {screen === 'prepare' && <Prepare/>}
          {screen === 'battle' && <Battle/>}
          {screen === 'status' && <Status/>}
          {screen === 'inventory' && <Inventory/>}
          {screen === 'companions' && <Companions/>}
          {screen === 'relay' && <Relay/>}
          {screen === 'settings' && <Settings/>}
          {screen === 'result' && <Result/>}

          <div className="mt-6 text-xs text-white/50">
            æ”¾ç½®å‹æˆ°é¬¥ï¼šL/H/S ä¸‰æ®µæ”»æ“Šï¼›å‘½ä¸­é€æ¬¡ +0/+10/+20ã€‚æˆ¿é–“é–“å›å¾© 8% HP/MPï¼›å›ä¸»ç•«é¢æ™‚å›æ»¿ï¼›æˆ°é¬¥ç´€éŒ„åœ¨æˆ¿é–“é–“ä¿ç•™ã€‚æ–°å¢ï¼šè£å‚™ç³»çµ±ï¼ˆæ­¦å™¨/èº«é«”/å‰¯è£ï¼‰ï¼Œåœ¨ä¸»ç•«é¢ã€Œè§’è‰²ã€æˆ–æº–å‚™éšæ®µå¯èª¿æ•´ã€‚
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
